/*
 * jQuery Sticky Header v0.8.0 (https://github.com/the-software-factory/jquery-sticky-header)
 * Copyright (c) 2015 Vendini srl <vendini@pec.it>
 * Licensed under MIT (https://github.com/the-software-factory/jquery-sticky-header/blob/master/LICENSE.md)
 */
!function(a){a.fn.stickyHeader=function(b){var c=a.extend({},a.fn.stickyHeader.defaults,b),d=0;return this.each(function(){a(this).attr(c.headerAttribute,"").hide(),0===a(this).find("["+c.headerContainerAttribute+"]").length&&a(this).attr(c.headerContainerAttribute,"");var b=new a.fn.stickyHeader.displayLevelManager(a("["+c.headerContainerAttribute+"]"),c);a("["+c.headerContainerAttribute+"]").empty();var e=new a.fn.stickyHeader.Container(a("["+c.headerContainerAttribute+"]"),c,b);a(window).scroll(function(){a("["+c.itemAttribute+"]").each(function(){var f=new a.fn.stickyHeader.Item(this,c);if(!f.getId()){f.setId(++d);var g=new MutationObserver(function(d){d.forEach(function(d){for(var f=0;f<d.removedNodes.length;f++){var g=new a.fn.stickyHeader.Item(d.removedNodes[f],c);if(g.isRemoved())return;(e.has(g)||b.isInLowerDisplayLevels(g))&&(g.setAsRemoved(),e.remove(g),b.removeItem(g))}})});g.observe(a("["+c.itemAttribute+"]").parent().toArray()[0],{childList:!0,subtree:!0})}!f.isHidden(window,e)&&e.has(f)?e.remove(f):!f.isHidden(window,e)||e.has(f)||b.isInLowerDisplayLevels(f)||e.add(f)})}),window.onhashchange=function(){var b=e.getSlots().toArray();for(var d in b){var f=a(b[d]).children().toArray();for(var g in f)e.remove(new a.fn.stickyHeader.Item(f[g],c))}a(window).scroll()}})},a.fn.stickyHeader.Container=function(b,c,d){this.add=function(e){var f="undefined"==typeof e.getPosition()?"L":e.getPosition();0===this.getSlot(f).length&&this.addSlot(f);var g=a(e.getHtml()).removeAttr(c.itemAttribute);void 0===g.attr(c.itemIdAttribute)&&g.attr(c.itemIdAttribute,e.getId()),e.requiresNewDisplayLevel()&&d.canCreateDisplayLevel(e)&&d.goToNextDisplayLevel(f),a(this.getSlot(f)).append(g),a(b).parents().find("["+c.headerAttribute+"]").show()},this.remove=function(e){a(b).find("["+c.itemIdAttribute+'="'+e.getId()+'"]').remove(),0===a(b).find("["+c.itemIdAttribute+"]").length&&a(b).parents().find("["+c.headerAttribute+"]").hide(),0===this.getSlot(e.getPosition()).find("["+c.itemIdAttribute+"]").length&&d.goToPrevDisplayLevel(e.getPosition())},this.getTopPaddings=function(){0===a(b).children().length&&a(b).append(a("<div></div>").attr("id","dummy-slot"));var d=a(b).children().first().parents();a(b).find("[id=dummy-slot]").remove();for(var e=0,f=0;f<d.length&&(e+=parseInt(a(d[f]).css("padding-top").replace("px","")),"undefined"==typeof a(d[f]).attr(c.headerAttribute));f++);return e},this.has=function(d){return a(b).find("["+c.itemIdAttribute+'="'+d.getId()+'"]').length>0},this.addSlot=function(d){if("L"===d)a(b).prepend("<div "+c.headerSlotPositionAttribute+'="L"></div>');else if("R"===d)a(b).append("<div "+c.headerSlotPositionAttribute+'="R"></div>');else{var e=a("<div "+c.headerSlotPositionAttribute+'="C"></div>');1===this.getSlot("L").length?(e.insertAfter(a(b).find("["+c.headerSlotPositionAttribute+'="L"]')),0===this.getSlot("R").length&&this.addSlot("R")):1===this.getSlot("R").length?(e.insertBefore(a(b).find("["+c.headerSlotPositionAttribute+'="R"]')),0===this.getSlot("L").length&&this.addSlot("L")):a(b).append(e)}},this.getSlot=function(d){return a(b).find("["+c.headerSlotPositionAttribute+"="+d+"]")},this.getSlots=function(){return a(b).children()}},a.fn.stickyHeader.Item=function(b,c){this.isHidden=function(c,d){return a(c).scrollTop()>a(b).offset().top-d.getTopPaddings()},this.requiresNewDisplayLevel=function(){return JSON.parse(a(b).attr(c.itemAttribute)).newDisplayLevel},this.setId=function(d){a(b).attr(c.itemIdAttribute,d)},this.getId=function(){return a(b).attr(c.itemIdAttribute)},this.getPosition=function(){return JSON.parse(a(b).attr(c.itemAttribute)).position},this.getHtml=function(){var d=JSON.parse(a(b).attr(c.itemAttribute));return"string"==typeof d.html?d.html:a(b).clone(!0)},this.isRemoved=function(){return"1"===a(b).attr(c.itemRemovedAttribute)},this.setAsRemoved=function(){a(b).attr(c.itemRemovedAttribute,"1")}},a.fn.stickyHeader.displayLevelManager=function(b,c){var d={L:0,C:0,R:0},e={L:[],C:[],R:[]};this.goToNextDisplayLevel=function(f){var g=d[f],h=e[f];h[g]=[],a(b).find("["+c.headerSlotPositionAttribute+"="+f+"]").find("["+c.itemIdAttribute+"]").each(function(b,d){var e=new a.fn.stickyHeader.Item(d,c);h[g].push(e.getId()),a(this).remove()}),++d[f]},this.goToPrevDisplayLevel=function(b){d[b]>0&&(e[b].splice(d[b],1),--d[b],a(window).scroll())},this.removeItem=function(a){e[a.getPosition()].forEach(function(b){var c=b.indexOf(a.getId());c>=0&&b.splice(c,1)})},this.isInLowerDisplayLevels=function(a){for(var b=a.getPosition(),c=0;c<d[b];c++)if(e[b][c].indexOf(a.getId())>=0)return!0;return!1},this.canCreateDisplayLevel=function(a){var b=a.getPosition(),c=e[b][d[b]];return Array.isArray(c)?c.indexOf(a.getId())<0:!0}},a.fn.stickyHeader.defaults={headerAttribute:"data-sticky-header",headerContainerAttribute:"data-sticky-header-container",headerSlotPositionAttribute:"data-sticky-header-slot-position",itemAttribute:"data-sticky-header-item",itemRemovedAttribute:"data-sticky-header-item-removed",itemIdAttribute:"data-sticky-header-item-id"}}(jQuery);